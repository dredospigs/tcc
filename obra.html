<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Obra</title>
</head>
<body>
    <link rel="stylesheet" href="./src/css/app.css">
    <link rel="stylesheet" href="./src/css/buttonSalesforce.css">
    <link rel="stylesheet" href="./src/css/obraStyle.css">
    <style>
        body {
            background-image: linear-gradient(90deg, #110e6b 0%, #3e024a 100%);
        }
        /* .menuMove{
            background-color: #a18aa6;
            position: fixed;
            bottom: 0;
            right: 0;
            min-width: 100em;
            min-height: 4em;
        } */
    </style>

    <form>
        <div class="login-box">
            <h2> Adicionar obra</h2>
            <div class="user-box">
                <input type="text" id="name" required=""/>
                <label for="name">Título da obra:</label>
            </div>
            <div class="user-box">
                <input type="text" id="endereço" required=""/>
                <label for="local">Endereço:</label>
            </div>
            <div class="user-box">
                <input type="text" id="cidade" onchange="validaLetras(document.getElementById('cidade'))" required=""/>
                <label for="cdd">Cidade:</label>
            </div>
            <div class="user-box">
                <input type="text" id="estado" onchange="validaLetras(document.getElementById('estado'))" required=""/>
                <label for="est">Estado:</label>
            </div>   
            <div class="user-box">
                <h4>Data prevista:</h4>
                <input type="text" id="mainDate" name="daterangeMain" value="" />
            </div>
            <div>                
                <div class="textAdd">Adicionar etapa</div>
                <input class="buttonAdd" type="button" value="+" onClick="addInput();">
            </div>

            <div  id="etapas"></div>     
            <div class="button">
                <button id="btnObra" type="button">CRIAR</button>
            </div>     
        </div> 
        <!-- <div class="menuMove">
        </div>    -->
    </form>

    <script type="module" src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>
    <script type="module" src="./src/firebaseConfig.js"></script>
    <script type="text/javascript" src="./src/verificadores.js"></script>
    <script type="text/javascript" src="./src/cadastrar.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" href="https://unpkg.com/balloon-css/balloon.min.css">

    <script>
        var data;

        $(function() {            
            $('input[name="daterangeMain"]').daterangepicker({
                opens: 'center',
                "locale": {
                    "format": "DD/MM/YYYY",
                    "separator": " - ",
                    "applyLabel": "Confirmar",
                    "cancelLabel": "Cancelar",
                    "fromLabel": "De",
                    "toLabel": "Até",
                    "customRangeLabel": "Custom",
                    "weekLabel": "W",
                    "daysOfWeek": [
                        "Dom",
                        "Seg",
                        "Ter",
                        "Qua",
                        "Qui",
                        "Sex",
                        "Sab"
                    ],
                    "monthNames": [
                        "Janeiro",
                        "Fevereiro",
                        "Março",
                        "Abril",
                        "Maio",
                        "Junho",
                        "Julho",
                        "Agosto",
                        "Setembro",
                        "Outubro",
                        "Novembro",
                        "Dezembro"
                    ],
                    "firstDay": 1
                }
                
            }, function(start, end, label) {
                data = start.format('DD/MM/YYYY') + " - " + end.format('DD/MM/YYYY')   
                var datas = data.split(' ')

                const minDate = datas[0]
                const maxDate = datas[2]
                $(function() {            
                    $('input[name="daterange"]').daterangepicker({
                        opens: 'center',
                        "minDate": minDate,
                        "maxDate": maxDate,
                        "locale": {
                            "format": "DD/MM/YYYY",
                            "separator": " - ",
                            "applyLabel": "Confirmar",
                            "cancelLabel": "Cancelar",
                            "fromLabel": "De",
                            "toLabel": "Até",
                            "customRangeLabel": "Custom",
                            "weekLabel": "W",
                            "daysOfWeek": [
                                "Dom",
                                "Seg",
                                "Ter",
                                "Qua",
                                "Qui",
                                "Sex",
                                "Sab"
                            ],
                            "monthNames": [
                                "Janeiro",
                                "Fevereiro",
                                "Março",
                                "Abril",
                                "Maio",
                                "Junho",
                                "Julho",
                                "Agosto",
                                "Setembro",
                                "Outubro",
                                "Novembro",
                                "Dezembro"
                            ],
                            "firstDay": 1
                        }
                        
                    });
                });             
            });
        });
    </script>
        
    <script>
        var nmrEtapa = 1;
        var id = 0;
        var firstAppear = true

        function addInput(){  
            data = document.getElementById('mainDate').value      
            var datas = data.split(' ')

            const minDate = datas[0]
            const maxDate = datas[2]
            
            var newdiv = document.createElement('div'); 
            newdiv.classList.add('box')

            if(firstAppear){
                newdiv.innerHTML = `<h3 data-balloon-visible aria-label="Dê dois cliques aqui para editar o titulo!" data-balloon-pos="up" class="tooltip-purple" contenteditable='true' style="width:12em" onfocus="removeTooltip(this.id)" id=${id} onblur='nullVerify(this.id)'>Etapa ${nmrEtapa}</h3>`+
                                `<input type='button' class='buttonRemove' value='-' onClick='removeInput(this);'><br>` + 
                                "<div class='user-box'><input type='text' name='myInputs[]' required=''><label for='equipe'>Equipe Responsável:</label> </div>" + 
                                "<div class='user-box'><input type='text' name='daterange' required=''/><label for='equipe'>Tempo estimado da etapa:</label> </div>" + 
                                "<div class='user-box'><input type='text' name='myInputs[]' required=''><label for='valor'>Valor da etapa:</label> </div>"
                firstAppear = false
            }
            else{
                newdiv.innerHTML = `<h3 contenteditable='true' style="width:12em" id=${id} onblur='nullVerify(this.id)'>Etapa ${nmrEtapa}</h3>`+
                                `<input type='button' class='buttonRemove' value='-' onClick='removeInput(this);'><br>` + 
                                "<div class='user-box'><input type='text' name='myInputs[]' required=''><label for='equipe'>Equipe Responsável:</label> </div>" + 
                                "<div class='user-box'><input type='text' name='daterange' required=''/><label for='equipe'>Tempo estimado da etapa:</label> </div>" + 
                                "<div class='user-box'><input type='text' name='myInputs[]' required=''><label for='valor'>Valor da etapa:</label> </div>"
            }

            document.getElementById('etapas').appendChild(newdiv);
            $(function() {            
                $('input[name="daterange"]').daterangepicker({
                    opens: 'center',
                    "minDate": minDate,
                    "maxDate": maxDate,
                    "locale": {
                        "format": "DD/MM/YYYY",
                        "separator": " - ",
                        "applyLabel": "Confirmar",
                        "cancelLabel": "Cancelar",
                        "fromLabel": "De",
                        "toLabel": "Até",
                        "customRangeLabel": "Custom",
                        "weekLabel": "W",
                        "daysOfWeek": [
                            "Dom",
                            "Seg",
                            "Ter",
                            "Qua",
                            "Qui",
                            "Sex",
                            "Sab"
                        ],
                        "monthNames": [
                            "Janeiro",
                            "Fevereiro",
                            "Março",
                            "Abril",
                            "Maio",
                            "Junho",
                            "Julho",
                            "Agosto",
                            "Setembro",
                            "Outubro",
                            "Novembro",
                            "Dezembro"
                        ],
                        "firstDay": 1
                    }
                    
                });
            });
            nmrEtapa++;
            id++;
        }
    
        function removeInput(btn){
            btn.parentNode.remove();
            nmrEtapa--;
        }

        function nullVerify(idItem){
            var etapaTitle = document.getElementById(`${idItem}`)
            if(etapaTitle.innerText === ""){
                idItem++;
                etapaTitle.innerText = `Etapa ${(idItem)}`
            }
        }

        function removeTooltip(idItem){
            var str = `<h3 contenteditable='true' style="width:12em" id=${idItem} onblur='nullVerify(this.id)'>Etapa 1</h3>`
            var Obj = document.getElementById(idItem); //any element to be fully replaced
            if(Obj.outerHTML) { 
                Obj.outerHTML=str;
            }
        }

        
    </script>
</body>
</html>